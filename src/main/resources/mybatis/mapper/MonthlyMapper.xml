<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN "
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zftx.mcdaily.mapper.MonthlyMapper">
    <resultMap id="monthly" type="com.zftx.mcdaily.bean.Monthly">
        <id column="id" property="id"/>
        <result column="user_id" property="userId"/>
        <result column="year" property="year"/>
        <result column="month" property="month"/>
        <result column="summary_id" property="summaryId"/>
        <result column="difficulty_id" property="difficultyId"/>
        <result column="programme_id" property="programmeId"/>
        <result column="suggest_id" property="suggestId"/>
        <result column="remark_id" property="remarkId"/>
    </resultMap>

    <!--查询-->
    <select id="getMonthly" resultType="java.util.HashMap">
          select m.*,u.full_name as fullName from monthly m
          join user u on m.user_id= u.id
          <if test="monthly != null">
              <where>
                  <if test="monthly.id != null">
                      m.id=#{monthly.id}
                  </if>
                  <if test="monthly.userId != null">
                      and m.user_id=#{monthly.userId}
                  </if>
                  <if test="monthly.year != null">
                      and m.year=#{monthly.year}
                  </if>
                  <if test="monthly.month != null">
                      and m.month=#{monthly.month}
                  </if>
                  <if test="monthly.summaryId != null">
                      and m.summaryId=#{monthly.summaryId}
                  </if>
                  <if test="monthly.difficultyId != null">
                      and m.difficulty_id=#{monthly.difficultyId}
                  </if>
                  <if test="monthly.programmeId != null">
                      and m.programme_id=#{monthly.programmeId}
                  </if>
                  <if test="monthly.suggestId != null">
                      and m.suggest_id=#{monthly.suggestId}
                  </if>
                  <if test="monthly.remarkId != null">
                      and m.remark_id=#{monthly.remarkId}
                  </if>
              </where>
          </if>
        order by m.year,m.month desc
    </select>

<!--

    &lt;!&ndash;添加 周报&ndash;&gt;
    <insert id="addWeekly" keyProperty="weekly.id" useGeneratedKeys="true" parameterType="com.zftx.mcdaily.bean.Weekly">
        INSERT INTO weekly
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="weekly !=null">
                <if test="weekly.userId!=null">
                    user_id,
                </if>
                <if test="weekly.week!=null">
                    week,
                </if>
                <if test="weekly.summaryId!=null">
                    summary_id,
                </if>
                <if test="weekly.summaryId==null">
                    summary_id,
                </if>
                <if test="weekly.difficultyId!=null">
                    difficulty_id,
                </if>
                <if test="weekly.difficultyId==null">
                    difficulty_id,
                </if>
                <if test="weekly.programmeId!=null">
                    programme_id,
                </if>
                <if test="weekly.programmeId==null">
                    programme_id,
                </if>
                <if test="weekly.suggestId!=null">
                    suggest_id,
                </if>
                <if test="weekly.suggestId==null">
                    suggest_id,
                </if>
                <if test="weekly.remarkId!=null">
                    remark_id,
                </if>
                <if test="weekly.remarkId==null">
                    remark_id,
                </if>
                <if test="weekly.sdate!=null">
                    sdate,
                </if>
                <if test="weekly.edate!=null">
                    edate,
                </if>
            </if>
        </trim>
        <trim prefix="VALUES (" suffix=")"  suffixOverrides=",">
            <if test="weekly !=null">
                <if test="weekly.userId!=null">
                    #{weekly.userId},
                </if>
                <if test="weekly.week!=null">
                    #{weekly.week},
                </if>
                <if test="weekly.summaryId!=null">
                    #{weekly.summaryId},
                </if>
                <if test="weekly.summaryId==null">
                  (SELECT CASE  WHEN MAX(w.summary_id) IS NULL THEN '1' ELSE MAX(w.summary_id)+1 END FROM weekly w),
                </if>
                <if test="weekly.difficultyId!=null">
                    #{weekly.difficultyId},
                </if>
                <if test="weekly.difficultyId==null">
                   (SELECT CASE  WHEN MAX(w.difficulty_id) IS NULL THEN '1' ELSE MAX(w.difficulty_id)+1 END FROM weekly w),
                </if>
                <if test="weekly.programmeId!=null">
                    #{weekly.programmeId},
                </if>
                <if test="weekly.programmeId==null">
                    (SELECT CASE  WHEN MAX(w.programme_id) IS NULL THEN '1' ELSE MAX(w.programme_id)+1 END FROM weekly w),
                </if>
                <if test="weekly.suggestId!=null">
                    #{weekly.suggestId},
                </if>
                <if test="weekly.suggestId==null">
                    (SELECT CASE  WHEN MAX(w.suggest_id) IS NULL THEN '1' ELSE MAX(w.suggest_id)+1 END FROM weekly w),
                </if>
                <if test="weekly.remarkId!=null">
                    #{weekly.remarkId},
                </if>
                <if test="weekly.remarkId==null">
                    (SELECT CASE  WHEN MAX(w.remark_id) IS NULL THEN '1' ELSE MAX(w.remark_id)+1 END FROM weekly w),
                </if>
                <if test="weekly.sdate!=null ">
                    #{weekly.sdate},
                </if>
                <if test="weekly.edate!=null ">
                    #{weekly.edate},
                </if>
            </if>
        </trim>
    </insert>
    &lt;!&ndash;                /*(SELECT CASE WHEN MAX(s.summary_id) IS NULL THEN '1' ELSE MAX(s.summary_id)+1 END FROM summary s),*/&ndash;&gt;
    <update id="updateWeekly" parameterType="com.zftx.mcdaily.bean.Weekly">
        UPDATE weekly
        <set>
            <if test="weekly.userId!=null">
                user_id=#{weekly.userId},
            </if>
            <if test="weekly.week!=null ">
                week=#{weekly.week},
            </if>
            <if test="weekly.summaryId!=null ">
                summary_id=#{weekly.summaryId},
            </if>
           <if test="weekly.difficultyId!=null">
               difficulty_id=#{weekly.difficultyId},
            </if>
           <if test="weekly.programmeId!=null">
               programme_id=#{weekly.programmeId},
            </if>
            <if test="weekly.suggestId!=null">
                suggest_id=#{weekly.suggestId},
            </if>
            <if test="weekly.remarkId!=null">
                remark_id=#{weekly.remarkId},
            </if>
            <if test="weekly.sdate!=null">
                sdate=#{weekly.sdate},
            </if>
            <if test="weekly.edate!=null">
                edate=#{weekly.edate},
            </if>
        </set>
        <where>
            <if test="weekly.id!=null and weekly.id!=0">
                 id=#{weekly.id}
            </if>
        </where>
    </update>


    &lt;!&ndash;实际删除 综合表&ndash;&gt;
    <delete id="deleteWeekly" parameterType="com.zftx.mcdaily.bean.Weekly">
       delete from weekly  where
       id=#{weekly.id}
    </delete>

    &lt;!&ndash;根据条件查询&ndash;&gt;
    <select id="getWeeklyByWhere" resultMap="weekly">
        select * from weekly
                <if test="weekly != null">
                    <where>
                        <if test="weekly.id != null">
                            id=#{weekly.id}
                        </if>
                        <if test="weekly.userId != null">
                            and user_id=#{weekly.userId}
                        </if>
                        <if test="weekly.week != null">
                            and week=#{weekly.week}
                        </if>
                        <if test="weekly.summaryId != null">
                            and summaryId=#{weekly.summaryId}
                        </if>
                        <if test="weekly.difficultyId != null">
                            and difficulty_id=#{weekly.difficultyId}
                        </if>
                        <if test="weekly.programmeId != null">
                            and programme_id=#{weekly.programmeId}
                        </if>
                        <if test="weekly.suggestId != null">
                            and suggest_id=#{weekly.suggestId}
                        </if>
                        <if test="weekly.remarkId != null">
                            and remark_id=#{weekly.remarkId}
                        </if>
                        <if test="weekly.sdate!= '' and weekly.sdate != null">
                            and sdate =#{weekly.sdate}
                        </if>
                        <if test="weekly.edate != '' and weekly.edate != null">
                            and edate =#{weekly.edate}
                        </if>
                    </where>
                </if>
    </select>
-->
    <!--实际删除 综合表-->
    <delete id="deleteMonthly" parameterType="com.zftx.mcdaily.bean.Monthly">
       delete from monthly  where
       id=#{monthly.id}
    </delete>
</mapper>